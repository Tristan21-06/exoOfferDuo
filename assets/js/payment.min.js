function nextSlide(e){slideItem<nbItems&&(instances[0].next(),slideItem++),checkSliderBtns()}function prevSlide(e){slideItem>0&&(instances[0].prev(),slideItem--),checkSliderBtns()}function checkSliderBtns(){0==slideItem&&($("#carousel-prev")[0].style.opacity=0,$("#carousel-prev")[0].style.cursor="initial",$("#carousel-prev")[0].disabled="disabled"),slideItem>0&&slideItem<nbItems&&($("#carousel-prev")[0].style.opacity=1,$("#carousel-prev")[0].style.cursor="pointer",$("#carousel-prev")[0].removeAttribute("disabled"),$("#carousel-next")[0].style.opacity=1,$("#carousel-next")[0].style.cursor="pointer",$("#carousel-next")[0].removeAttribute("disabled")),slideItem==nbItems&&($("#carousel-next")[0].style.opacity=0,$("#carousel-next")[0].style.cursor="initial",$("#carousel-next")[0].disabled="disabled")}function validButton(){let e=!0;formInputs.forEach(t=>{t.value&&""!=t.value||(e=e&&!1)}),e?($("#valid-payment")[0].disabled="disabled",document.getElementById("payment-last").querySelector("i").classList.add("disabled")):($("#valid-payment")[0].removeAttribute("disabled"),document.getElementById("payment-last").querySelector("i").classList.remove("disabled"))}function writeFile(){$.ajax({url:"/includes/writeFile.php",data:{jsonString:JSON.stringify(jsonObjects)},success:function(){}})}let params=new URLSearchParams(window.location.search),cData=params.get("cart");cData&&cData.length||(alert("Aucun panier n'est sélectionné"),window.location.replace("/"));let slideItem=0,nbItems=$(".carousel-item").length-1;var instances,jsonObjects,cart,cartIndex;let form=document.getElementById("payment-form");form.addEventListener("submit",e=>validCart(e)),$.ajax({url:"/includes/getData.php",data:{},success:function(e){jsonObjects=JSON.parse(e),cart=jsonObjects.carts.objects.find(e=>e.id==cData),cartIndex=jsonObjects.carts.objects.indexOf(cart)}}),document.addEventListener("DOMContentLoaded",function(){var e=document.querySelectorAll(".carousel");instances=M.Carousel.init(e,{fullWidth:!0})});let formInputs=Array.from(document.querySelectorAll("#payment-form input"));var separator="/";$("#expiration-card").keyup(function(e){var t=$(this).val();191!=e.keyCode&&111!=e.keyCode&&e.keyCode>=96&&e.keyCode<=105?8!=e.keyCode?2==t.length&&(t>12&&(t=12),$(this).val(t+separator)):5==t.length?$(this).val(t.substring(0,4)):2==t.length&&$(this).val(t.substring(0,1)):$(this).val(t.substring(0,t.length-1))}),$(document).ready(function(){$("#card-number")[0].addEventListener("keyup",e=>{let t=(""+e.target.value).split("").map((e,t)=>(t+1)%4==0?e+" ":e).join("");$("#card-value")[0].innerText=t,e.target.value.length>16&&($("#card-value")[0].innerText=$("#card-value")[0].innerText.slice(0,19),e.target.value=parseInt((""+e.target.value).slice(0,16)))}),$("#carousel-prev")[0].addEventListener("click",e=>prevSlide(e)),$("#carousel-next")[0].addEventListener("click",e=>nextSlide(e)),formInputs.forEach(e=>{e.addEventListener("change",validButton())}),instances[0].set(slideItem),checkSliderBtns()});const validCart=async e=>{e.preventDefault();let t=Array.from(e.target.elements);t=t.filter(e=>e.name&&e.name.length);let a=!1;if(t.forEach(e=>{""==e.value&&(a=a||!0)}),a)M.toast({html:"Formulaire non valide!",classes:"red toast"});else{cart.status="Commande payee";let e=cart.userId,a={};for(let e of t)a[e.name]=e.value;jsonObjects.addresses.lastId++,a.id=jsonObjects.addresses.lastId,a.userId=e,a.cartId=cart.id,jsonObjects.addresses.objects.push(a),writeFile(form),M.toast({html:"Commande validé!",classes:"green toast"}),$("#valid-payment")[0].disabled="disabled",document.getElementById("payment-last").querySelector("i").classList.add("disabled"),await delay(2e3),window.location.replace("/")}},delay=e=>new Promise(t=>setTimeout(t,e));