function buildCart(){if(!currU)return $("#display-cart").html(userForm()),void $("#user-connect")[0].addEventListener("submit",connectUser);if(!currCart||0==currCart.articles.length)return void $("#display-cart").html("<blockquote>Aucun article dans le panier</blockquote>");let e="";e+="<div>",currCart.articles.forEach(t=>{e+="<div>",e+='<div class="card">',e+='<div class="card-image">',e+=`<img src="${t.image}">`,e+=`<span class="card-title">${t.name}</span>`,e+=`<a class="btn-floating halfway-fab waves-effect waves-light red" data-id="${t.id}">`,e+='<i class="material-icons">delete</i>',e+="</a>",e+="</div>",e+='<div class="card-content">',e+=`<p>Quantité </p> <input type="number" data-id="${t.id}">`,e+="</div>",e+="</div>"}),e+="</div>",e+='<a href="/pages/payment.php" class="waves-effect waves-light btn">Valider le panier</a>',$("#display-cart").html(e),document.getElementsByClassName("cancel-article-btn").forEach(e=>{console.log(e.dataset.id),e.addEventListener("click",cancelArticle(e.dataset.id))}),document.getElementsByClassName("quantity-article-btn").forEach(e=>{console.log(e.dataset.id),e.addEventListener("change",editQuantity(e.dataset.id,e.value))})}function cancelArticle(e){}async function connectUser(e){let t=$("#error-connect")[0];t.querySelector("blockquote").innerText="Combinaison utilisateur/mot de passe inconnue. Veuillez réessayer",t.classList.remove("error-active"),e.preventDefault();const a=new FormData(e.target),s=Object.fromEntries(a);if(currU=jsonObjects.users.objects.find(e=>e.username==s.username&&e.password==s.password),!currU)return t.querySelector("blockquote").innerText="Combinaison utilisateur/mot de passe inconnue. Veuillez réessayer",void t.classList.add("error-active");currCart=jsonObjects.carts.objects.find(e=>e.userId==currU.id&&"Panier"==e.status),currCart||(jsonObjects.carts.lastId++,emptyCart={id:jsonObjects.carts.lastId,articles:[],user:currU.id},jsonObjects.carts.objects.push(emptyCart),$.ajax({url:"/includes/writeFile.php",data:{jsonString:JSON.stringify(jsonObjects)},success:function(){console.log("KACHOWWW")}}));let i="";i+='<div id="loader-container">',i+='<div class="preloader-wrapper big active">',i+='<div class="spinner-layer spinner-red-only">',i+='<div class="circle-clipper left">',i+='<div class="circle"></div>',i+="</div>",i+='<div class="gap-patch">',i+='<div class="circle">',i+="</div>",i+="</div>",i+='<div class="circle-clipper right">',i+='<div class="circle"></div>',i+="</div>",i+="</div>",i+="</div>",$("#display-cart").html(i),await delay(4e3),$("#display-cart").html("<h4>Utilisateur connecté!</h4>"),await delay(4e3),buildCart()}function userForm(){let e="";return e+="<div>",e+="<h3>Connectez-vous pour avoir accès à votre panier</h3>",e+='<form id="user-connect">',e+='<div class="input-field">',e+='<input id="first_name" type="text" name="username" class="validate">',e+='<label for="first_name">Utilisateur</label>',e+="</div>",e+='<div class="input-field">',e+='<input id="password" type="password" name="password" class="validate">',e+='<label for="password">Mot de passe</label>',e+="</div>",e+='<div class="input-field">',e+='<button type="submit" class="waves-effect waves-light btn">Se connecter</button>',e+="</div>",e+="<form>",e+="<div>",e}let jsonObjects,currU,currCart;$(document).ready(function(){$(".sidenav").sidenav()}),fetch("/localDB/DB.json").then(e=>e.json()).then(e=>{jsonObjects=e}),document.getElementById("show-cart").addEventListener("click",buildCart);const delay=e=>new Promise(t=>setTimeout(t,e));