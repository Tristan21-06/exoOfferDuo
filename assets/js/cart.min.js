function buildCart(){if(!currU)return $("#display-cart").html(userForm()),void $("#user-connect")[0].addEventListener("submit",connectUser);if(!currCart||0==currCart.articles.length)return void $("#display-cart").html("<blockquote>Aucun article dans le panier</blockquote>");let e="";e+="<div>",currCart.articles.forEach(t=>{e+="<div>",e+='<div class="card">',e+='<div class="card-image">',e+=`<img src="${t.image}">`,e+=`<span class="card-title">${t.name}</span>`,e+=`<a class="btn-floating halfway-fab waves-effect waves-light red cancel-article-btn" data-id="${t.id}">`,e+='<i class="material-icons">delete</i>',e+="</a>",e+="</div>",e+='<div class="card-content">',e+=`<p>Quantité </p> <input id="first_name" type="number" class="quantity-article-btn validate" data-id="${t.id}">`,e+="</div>",e+="</div>"}),e+="</div>",e+='<a href="/pages/payment.php" class="waves-effect waves-light btn">Valider le panier</a>',$("#display-cart").html(e);let t=Array.from(document.getElementsByClassName("cancel-article-btn"));t.forEach(e=>{e.addEventListener("click",cancelArticle(e.dataset.id))});let a=Array.from(document.getElementsByClassName("quantity-article-btn"));a.forEach(e=>{e.addEventListener("change",editQuantity(e.dataset.id,e.value))})}function addArticle(e,t){if(t.preventDefault(),!currU)return $("#show-cart")[0].click(),M.toast({html:"Veuillez vous connecter!",classes:"red toast"}),void buildCart();currCart.articles.push({id:e,quantity:1});let a=jsonObjects.carts.objects.indexOf(currCart.id);jsonObjects.carts.objects[a]=currCart,writeFile(),M.toast({html:"Article ajouté au panier!",classes:"green toast"})}function cancelArticle(e){currCart.articles.filter(t=>t.id!=e);let t=jsonObjects.carts.objects.indexOf(currCart.id);jsonObjects.carts.objects[t]=currCart,writeFile(),M.toast({html:"Article supprimé du panier!",classes:"red toast"})}function editQuantity(e,t){currCart.articles.find(t=>t.id==e).quantity=t;let a=jsonObjects.carts.objects.indexOf(currCart.id);jsonObjects.carts.objects[a]=currCart,writeFile()}async function connectUser(e){let t=$("#error-connect")[0];t.querySelector("blockquote").innerText="Combinaison utilisateur/mot de passe inconnue. Veuillez réessayer",t.classList.remove("error-active"),e.preventDefault();const a=new FormData(e.target),r=Object.fromEntries(a);if(currU=jsonObjects.users.objects.find(e=>e.username==r.username&&e.password==r.password),!currU)return t.querySelector("blockquote").innerText="Combinaison utilisateur/mot de passe inconnue. Veuillez réessayer",void t.classList.add("error-active");currCart=jsonObjects.carts.objects.find(e=>e.userId==currU.id&&"Panier"==e.status),currCart||(jsonObjects.carts.lastId++,currCart={id:jsonObjects.carts.lastId,articles:[],user:currU.id,status:"Panier"},jsonObjects.carts.objects.push(currCart),writeFile());let s="";s+='<div id="loader-container">',s+='<div class="preloader-wrapper big active">',s+='<div class="spinner-layer spinner-red-only">',s+='<div class="circle-clipper left">',s+='<div class="circle"></div>',s+="</div>",s+='<div class="gap-patch">',s+='<div class="circle">',s+="</div>",s+="</div>",s+='<div class="circle-clipper right">',s+='<div class="circle"></div>',s+="</div>",s+="</div>",s+="</div>",$("#display-cart").html(s),await delay(4e3),$("#display-cart").html("<h4>Utilisateur connecté!</h4>"),await delay(4e3),buildCart()}function userForm(){let e="";return e+="<div>",e+="<h3>Connectez-vous pour avoir accès à votre panier</h3>",e+='<form id="user-connect">',e+='<div class="input-field">',e+='<input id="first_name" type="text" name="username" class="validate">',e+='<label for="first_name">Utilisateur</label>',e+="</div>",e+='<div class="input-field">',e+='<input id="password" type="password" name="password" class="validate">',e+='<label for="password">Mot de passe</label>',e+="</div>",e+='<div class="input-field">',e+='<button type="submit" class="waves-effect waves-light btn">Se connecter</button>',e+="</div>",e+="<form>",e+="<div>",e}function writeFile(){$.ajax({url:"/includes/writeFile.php",data:{jsonString:JSON.stringify(jsonObjects)},success:function(){console.log("KACHOWWW")}})}let jsonObjects,currU,currCart;$(document).ready(function(){$(".sidenav").sidenav()}),fetch("/localDB/DB.json").then(e=>e.json()).then(e=>{jsonObjects=e}),document.getElementById("show-cart").addEventListener("click",buildCart);let addToCart=Array.from(document.getElementsByClassName("add-to-cart"));addToCart.forEach(e=>{e.addEventListener("click",t=>addArticle(e.dataset.id,t))});const delay=e=>new Promise(t=>setTimeout(t,e));