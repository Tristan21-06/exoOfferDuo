function buildCart(){if(!currU)return $("#display-cart").html(userForm()),void $("#user-connect")[0].addEventListener("submit",connectUser);if(!currCart||0==currCart.articles.length)return void $("#display-cart").html("<blockquote>Aucun article dans le panier</blockquote>");let t="";t+="<div>",currCart.articles.forEach(e=>{let a=jsonObjects.articles.find(t=>t.id==e.id);a.quantity=e.quantity,t+="<div>",t+='<div class="card">',t+='<div class="card-image">',t+=`<img src="${a.image}">`,t+=`<span class="card-title">${a.name}</span>`,t+=`<a class="btn-floating halfway-fab waves-effect waves-light red cancel-article-btn" data-id="${a.id}">`,t+='<i class="material-icons">delete</i>',t+="</a>",t+="</div>",t+='<div class="card-content">',t+=`<p>Quantité </p> <input id="first_name" type="number" class="quantity-article-btn validate" value="${a.quantity}" data-id="${a.id}">`,t+="</div>",t+="</div>"}),t+="</div>",t+='<a href="/pages/payment.php" class="waves-effect waves-light btn">Valider le panier</a>',$("#display-cart").html(t);let e=Array.from(document.getElementsByClassName("cancel-article-btn"));e.forEach(t=>{t.addEventListener("click",e=>cancelArticle(t.dataset.id,e))});let a=Array.from(document.getElementsByClassName("quantity-article-btn"));a.forEach(t=>{t.addEventListener("change",e=>editQuantity(t.dataset.id,t.value,e))})}function addArticle(t,e){if(e.preventDefault(),!currU)return $("#show-cart")[0].click(),M.toast({html:"Veuillez vous connecter!",classes:"red toast"}),void buildCart();if(currCart.articles.filter(e=>e.id==t).length>0)return void M.toast({html:"Article déjà dans le panier!",classes:"red toast"});currCart.articles.push({id:t,quantity:1});let a=jsonObjects.carts.objects.indexOf(currCart);jsonObjects.carts.objects[a]=currCart,writeFile(),M.toast({html:"Article ajouté au panier!",classes:"green toast"})}function cancelArticle(t,e){if(!e.target.classList.contains("cancel-article-btn")&&!e.target.classList.contains("material-icons"))return;let a=jsonObjects.carts.objects.indexOf(currCart);currCart.articles=currCart.articles.filter(e=>e.id!=t),a>=0&&(jsonObjects.carts.objects[a]=currCart,M.toast({html:"Article supprimé du panier!",classes:"green toast"}),writeFile(),buildCart())}function editQuantity(t,e,a){if(!a.target.classList.contains("quantity-article-btn")||!a.target.classList.contains("material-icons"))return;if(!currCart.articles.length)return void M.toast({html:"Article introuvable!",classes:"red toast"});let r=jsonObjects.carts.objects.indexOf(currCart),s=currCart.articles.find(e=>e.id=t),i=currCart.articles.indexOf(s);r>=0&&i>=0&&(currCart.articles[i].quantity=e,jsonObjects.carts.objects[r]=currCart,writeFile(),M.toast({html:"Quantité modifiée!",classes:"green toast"}),buildCart())}async function connectUser(t){let e=$("#error-connect")[0];e.querySelector("blockquote").innerText="Combinaison utilisateur/mot de passe inconnue. Veuillez réessayer",e.classList.remove("error-active"),t.preventDefault();const a=new FormData(t.target),r=Object.fromEntries(a);if(currU=jsonObjects.users.objects.find(t=>t.username==r.username&&t.password==r.password),!currU)return e.querySelector("blockquote").innerText="Combinaison utilisateur/mot de passe inconnue. Veuillez réessayer",void e.classList.add("error-active");currCart=jsonObjects.carts.objects.find(t=>t.userId==currU.id&&"Panier"==t.status),currCart||(jsonObjects.carts.lastId++,currCart={id:jsonObjects.carts.lastId,articles:[],userId:currU.id,status:"Panier"},jsonObjects.carts.objects.push(currCart),writeFile());let s="";s+='<div id="loader-container">',s+='<div class="preloader-wrapper big active">',s+='<div class="spinner-layer spinner-red-only">',s+='<div class="circle-clipper left">',s+='<div class="circle"></div>',s+="</div>",s+='<div class="gap-patch">',s+='<div class="circle">',s+="</div>",s+="</div>",s+='<div class="circle-clipper right">',s+='<div class="circle"></div>',s+="</div>",s+="</div>",s+="</div>",$("#display-cart").html(s),await delay(4e3),M.toast({html:"Utilisateur connecté!",classes:"green toast"}),await delay(4e3),buildCart()}function userForm(){let t="";return t+="<div>",t+="<h3>Connectez-vous pour avoir accès à votre panier</h3>",t+='<form id="user-connect">',t+='<div class="input-field">',t+='<input id="first_name" type="text" name="username" class="validate">',t+='<label for="first_name">Utilisateur</label>',t+="</div>",t+='<div class="input-field">',t+='<input id="password" type="password" name="password" class="validate">',t+='<label for="password">Mot de passe</label>',t+="</div>",t+='<div class="input-field">',t+='<button type="submit" class="waves-effect waves-light btn">Se connecter</button>',t+="</div>",t+="<form>",t+="<div>",t}function writeFile(){$.ajax({url:"/includes/writeFile.php",data:{jsonString:JSON.stringify(jsonObjects)},success:function(){}})}let jsonObjects,currU,currCart;$(document).ready(function(){$(".sidenav").sidenav()}),$.ajax({url:"/includes/getData.php",data:{jsonString:JSON.stringify(jsonObjects)},success:function(t){jsonObjects=JSON.parse(t)}}),document.getElementById("show-cart").addEventListener("click",buildCart);let addToCart=Array.from(document.getElementsByClassName("add-to-cart"));addToCart.forEach(t=>{t.addEventListener("click",e=>addArticle(t.dataset.id,e))});const delay=t=>new Promise(e=>setTimeout(e,t));